<!DOCTYPE html>

<html lang='en'>

<head>
    <meta charset="UTF-8">
    <meta name="viewpoint" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Temperatura</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
</head>

<body>
    <h1>Gr√°fico</h1>
    <div class="row no-gutters">

        <div class="col">
            <div class="leftside">

                <input id="button" type="submit" value="Test Send Data" , onclick="adddata()" />
                <p id="demo"></p>

                <p <span id="sensor"></span> ></p>

            </div>

        </div>

        <div class="col">
            <div class="rightside">
                <canvas id="myChart" width="700" height="700"></canvas>
            </div>
        </div>
    </div>
    <script>
        const ctx = document.getElementById('myChart').getContext('2d');
        const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Temperature',
                    data: [],
                    fill: false,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: false, //config responsible to resize chart
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        async function adddata() {
            temp_data = await getDataTemperature();
            console.log(temp_data)
            myChart.data.datasets[0].data = temp_data.ys;
            myChart.data.labels = temp_data.xs;
            myChart.update();
        }

        async function getDataTemperature() {
            const url = 'https://us-east-1.aws.webhooks.mongodb-realm.com/api/client/v2.0/app/temperature_analysis-gjbaa/service/get_temperature/incoming_webhook/get_temperature?db=iot&collection=readings';
            const response = await fetch(url);
            const data = await response.json();
            const ys = [];
            const xs = [];

            //const obj = JSON.parse(data[0]);
            for (i = 0; i < data.length; i++) {
                ys.push((data[i].sensor.temperature));
                xs.push(i);
                console.log(((data[i].sensor.temperature)));
            }
            //document.getElementById("demo").innerHTML = ys;
            return { xs, ys };
        }
        adddata();
        //setInterval(adddata, 1000);
        //getDataTemperature();
    </script>
    <script type="text/javascript">

        function myFunction() {

            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", "http://127.0.0.1:8080/temperature/array");
            xmlHttp.onload = () => {
                console.log(xmlHttp.responseText);
                document.getElementById("demo").innerHTML = xmlHttp.responseText;

            };
            xmlHttp.send(null);

            console.log(xmlHttp.responseText);
        }

    </script>
</body>